/*
 * Decompiled with CFR 0.152.
 * 
 * Could not load the following classes:
 *  com.google.common.eventbus.Subscribe
 */
package cc.diablo.module.impl.exploit;

import cc.diablo.event.impl.PacketEvent;
import cc.diablo.event.impl.TickEvent;
import cc.diablo.helpers.PacketHelper;
import cc.diablo.helpers.Stopwatch;
import cc.diablo.module.Category;
import cc.diablo.module.Module;
import cc.diablo.setting.impl.ModeSetting;
import cc.diablo.setting.impl.NumberSetting;
import com.google.common.eventbus.Subscribe;
import java.util.ArrayList;
import net.minecraft.network.Packet;

public class Blink
extends Module {
    public ArrayList<Packet> packets = new ArrayList();
    public ModeSetting mode = new ModeSetting("Blink mode", "Pulse", "Pulse", "Static");
    public NumberSetting pulseDelay = new NumberSetting("Delay", 3000.0, 50.0, 10000.0, 50.0);
    public Stopwatch timer = new Stopwatch();

    public Blink() {
        super("Blink", "Delays packets from being sent", 0, Category.Exploit);
        this.addSettings(this.mode, this.pulseDelay);
    }

    @Override
    public void onEnable() {
        this.timer.reset();
        super.onEnable();
    }

    @Override
    public void onDisable() {
        for (Packet packet : this.packets) {
            PacketHelper.sendPacketNoEvent(packet);
        }
        this.packets.clear();
        this.timer.reset();
        super.onDisable();
    }

    @Subscribe
    public void onTick(TickEvent e) {
        this.setDisplayName("Blink\u00a77 " + this.mode.getMode());
        switch (this.mode.getMode()) {
            case "Pulse": {
                if (!this.timer.hasReached((long)this.pulseDelay.getVal())) break;
                for (Packet packet : this.packets) {
                    PacketHelper.sendPacketNoEvent(packet);
                }
                this.packets.clear();
            }
        }
    }

    @Subscribe
    public void onPacket(PacketEvent e) {
        if (e.isOutgoing()) {
            this.packets.add(e.getPacket());
            e.setCancelled(true);
        }
    }
}

