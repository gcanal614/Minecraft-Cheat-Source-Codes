package today.sleek.client.modules.impl.exploit;

import com.google.common.eventbus.Subscribe;
import net.minecraft.network.play.client.C01PacketChatMessage;
import org.apache.commons.lang3.RandomUtils;
import today.sleek.base.event.impl.PacketEvent;
import today.sleek.base.modules.ModuleCategory;
import today.sleek.base.modules.ModuleData;
import today.sleek.client.modules.impl.Module;
import today.sleek.client.utils.network.PacketUtil;

@ModuleData(
        name = "Chat Bypass",
        category = ModuleCategory.EXPLOIT,
        description = "Bypasses chat filters"
)
public class FilterBypass extends Module {

    private final char[] BYPASS_CHARS = {'⛏', '⛘', '⛜', '⛠', '⛟', '⛐', '⛍', '⛡', '⛋', '⛌', '⛗', '⛩', '⛉'};

    @Subscribe
    public void onPacket(PacketEvent event) {
        if (event.getPacket() instanceof C01PacketChatMessage) {
            String msg = ((C01PacketChatMessage) event.getPacket()).getMessage();

            if (msg.startsWith("/"))
                return;

            //split the msg to a char array
            char[] splitString = msg.toCharArray();
            StringBuilder b = new StringBuilder();

            //loop through them
            for (char c : splitString) {
                //add an invisible character randomly
                if (RandomUtils.nextInt(0, 4) == 0) {
                    b.append(BYPASS_CHARS[RandomUtils.nextInt(0, BYPASS_CHARS.length)]);
                }

                b.append(c);
            }

            //cancel
            event.setCancelled(true);

            //send the packet
            PacketUtil.sendPacketNoEvent(new C01PacketChatMessage(b.toString()));
        }
    }
}
