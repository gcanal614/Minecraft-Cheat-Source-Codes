package today.sleek.client.modules.impl.exploit;

import com.google.common.eventbus.Subscribe;
import today.sleek.base.event.impl.MoveEvent;
import today.sleek.base.event.impl.PacketEvent;
import today.sleek.base.event.impl.UpdateEvent;
import today.sleek.base.modules.ModuleCategory;
import today.sleek.base.modules.ModuleData;
import today.sleek.base.value.value.BooleanValue;
import today.sleek.base.value.value.ModeValue;
import today.sleek.base.value.value.NumberValue;
import today.sleek.client.modules.impl.Module;
import today.sleek.client.modules.impl.exploit.disabler.DisablerMode;
import today.sleek.client.utils.java.ReflectUtils;
import today.sleek.client.utils.math.Stopwatch;

import javax.vecmath.Vector3d;
import java.util.Comparator;
import java.util.List;
import java.util.stream.Collectors;

@ModuleData(name = "Disabler", category = ModuleCategory.EXPLOIT, description = "Disables anticheats")
public class Disabler extends Module {
    private final List<? extends DisablerMode> modes = ReflectUtils.getReflects(this.getClass().getPackage().getName() + ".disabler", DisablerMode.class).stream().map(aClass -> {
        try {
            return aClass.getDeclaredConstructor().newInstance();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return null;
    }).sorted(Comparator.comparing(disablerMode -> disablerMode != null ? disablerMode.getName() : null)).collect(Collectors.toList());
    private final ModeValue mode = new ModeValue("Mode", this, modes.stream().map(DisablerMode::getName).collect(Collectors.toList()).toArray(new String[] {}));
    private DisablerMode currentMode = modes.stream().anyMatch(disablerMode -> disablerMode.getName().equalsIgnoreCase(mode.getValue())) ? modes.stream().filter(disablerMode -> disablerMode.getName().equalsIgnoreCase(mode.getValue())).findAny().get() : null;
    private Vector3d repeatPos = new Vector3d();
    private final Stopwatch stopwatch = new Stopwatch();
    //blocks delay
    private final NumberValue bmcDelay = new NumberValue("Delay", this, 350, 0, 1000, 1, mode, "BlocksMC");
    //Custom Shit
    private final BooleanValue cancelTransactions = new BooleanValue("Cancel Transactions", this, false, mode, "Custom");
    private final BooleanValue cancelKeepAlives = new BooleanValue("Cancel Keep Alive", this, false, mode, "Custom");
    private final BooleanValue delayTransactions = new BooleanValue("Delay Transactions", this, false, mode, "Custom");
    private final NumberValue delayTransAmount = new NumberValue("Transaction Delay", this, 1000, 0, 60000, 0.1, delayTransactions);
    private final BooleanValue delayKeepAlives = new BooleanValue("Delay Keep Alive", this, false, mode, "Custom");
    private final NumberValue delayKeepAliveAmount = new NumberValue("Delay Alive Amount", this, 1000, 0, 60000, 0.1, delayKeepAlives);
    private final BooleanValue sendC0C = new BooleanValue("Send C0C", this, false, mode, "Custom");
    private final BooleanValue maxc0c = new BooleanValue("Max Value C0C", this, false, mode, "Custom");
    private final BooleanValue voidTeleport = new BooleanValue("Void Teleport", this, false, mode, "Custom");
    private final NumberValue voidTpDelay = new NumberValue("TP Delay", this, 3000, 0, 60000, 1, voidTeleport);
    private final NumberValue voidTpAmount = new NumberValue("TP Amount", this, -999999999, 0, 6000000, 0.1, voidTeleport);
    private final BooleanValue spoofOnGround = new BooleanValue("Spoof Ground", this, false, mode, "Custom");
    private final BooleanValue offGround = new BooleanValue("No ground", this, false, mode, "Custom");
    private final BooleanValue spectateSpoof = new BooleanValue("Spectate Spoof", this, false, mode, "Custom");
    private final BooleanValue abilitiesSpoof = new BooleanValue("Abilities Spoof", this, false, mode, "Custom");
    private final BooleanValue timer = new BooleanValue("Timer", this, false, mode, "Custom");
    private final NumberValue timerSpeed = new NumberValue("Timer Speed", this, 1, 0.1, 10, 0.1, timer);
    public final BooleanValue autoDisable = new BooleanValue("Hub Disable", this, false, mode, "BlocksMC");
    private boolean expectedTeleport;

    @Override
    public void onEnable() {
        currentMode = modes.stream().anyMatch(disablerMode -> disablerMode.getName().equalsIgnoreCase(mode.getValue())) ? modes.stream().filter(disablerMode -> disablerMode.getName().equalsIgnoreCase(mode.getValue())).findAny().get() : null; // Its shouldn't be null
        if (currentMode != null) currentMode.onEnable();
    }

    @Subscribe
    public void onSendPacket(PacketEvent event) {
        if (currentMode == null) return;
        currentMode.onPacket(event);
    }

    @Subscribe
    public void onMove(MoveEvent event) {
        if (currentMode == null) return;
        currentMode.onMove(event);
    }

    @Subscribe
    public void onUpdate(UpdateEvent event) {
        if (currentMode == null) return;
        currentMode.onUpdate(event);
    }

    boolean shouldRun() {
        return mc.thePlayer != null && mc.thePlayer.ticksExisted > 5;
    }

    @Override
    public String getSuffix() {
        return " " + mode.getValueAsString();
    }

    @SuppressWarnings("all")
    public List<? extends DisablerMode> getModes() {
        return this.modes;
    }

    @SuppressWarnings("all")
    public ModeValue getMode() {
        return this.mode;
    }

    @SuppressWarnings("all")
    public DisablerMode getCurrentMode() {
        return this.currentMode;
    }

    @SuppressWarnings("all")
    public Vector3d getRepeatPos() {
        return this.repeatPos;
    }

    @SuppressWarnings("all")
    public Stopwatch getStopwatch() {
        return this.stopwatch;
    }

    @SuppressWarnings("all")
    public NumberValue getBmcDelay() {
        return this.bmcDelay;
    }

    @SuppressWarnings("all")
    public BooleanValue getCancelTransactions() {
        return this.cancelTransactions;
    }

    @SuppressWarnings("all")
    public BooleanValue getCancelKeepAlives() {
        return this.cancelKeepAlives;
    }

    @SuppressWarnings("all")
    public BooleanValue getDelayTransactions() {
        return this.delayTransactions;
    }

    @SuppressWarnings("all")
    public NumberValue getDelayTransAmount() {
        return this.delayTransAmount;
    }

    @SuppressWarnings("all")
    public BooleanValue getDelayKeepAlives() {
        return this.delayKeepAlives;
    }

    @SuppressWarnings("all")
    public NumberValue getDelayKeepAliveAmount() {
        return this.delayKeepAliveAmount;
    }

    @SuppressWarnings("all")
    public BooleanValue getSendC0C() {
        return this.sendC0C;
    }

    @SuppressWarnings("all")
    public BooleanValue getMaxc0c() {
        return this.maxc0c;
    }

    @SuppressWarnings("all")
    public BooleanValue getVoidTeleport() {
        return this.voidTeleport;
    }

    @SuppressWarnings("all")
    public NumberValue getVoidTpDelay() {
        return this.voidTpDelay;
    }

    @SuppressWarnings("all")
    public NumberValue getVoidTpAmount() {
        return this.voidTpAmount;
    }

    @SuppressWarnings("all")
    public BooleanValue getSpoofOnGround() {
        return this.spoofOnGround;
    }

    @SuppressWarnings("all")
    public BooleanValue getOffGround() {
        return this.offGround;
    }

    @SuppressWarnings("all")
    public BooleanValue getSpectateSpoof() {
        return this.spectateSpoof;
    }

    @SuppressWarnings("all")
    public BooleanValue getAbilitiesSpoof() {
        return this.abilitiesSpoof;
    }

    @SuppressWarnings("all")
    public BooleanValue getTimer() {
        return this.timer;
    }

    @SuppressWarnings("all")
    public NumberValue getTimerSpeed() {
        return this.timerSpeed;
    }

    @SuppressWarnings("all")
    public BooleanValue getAutoDisable() {
        return this.autoDisable;
    }

    @SuppressWarnings("all")
    public boolean isExpectedTeleport() {
        return this.expectedTeleport;
    }

    @SuppressWarnings("all")
    public void setRepeatPos(final Vector3d repeatPos) {
        this.repeatPos = repeatPos;
    }
}
