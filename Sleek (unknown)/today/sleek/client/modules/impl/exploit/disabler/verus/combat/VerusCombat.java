package today.sleek.client.modules.impl.exploit.disabler.verus.combat;

import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C0BPacketEntityAction;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;
import today.sleek.base.event.impl.PacketEvent;
import today.sleek.base.event.impl.UpdateEvent;
import today.sleek.client.modules.impl.exploit.disabler.DisablerMode;
import today.sleek.client.utils.chat.ChatUtil;
import today.sleek.client.utils.network.PacketUtil;

import java.util.LinkedList;

public class VerusCombat extends DisablerMode {

    private LinkedList<Packet> transactions = new LinkedList<>();
    public VerusCombat() {
        super("Verus Combat");
    }

    @Override
    public void onEnable() {
        transactions.clear();
    }

    @Override
    public void onPacket(PacketEvent event) {
        if (event.getPacket() instanceof C0FPacketConfirmTransaction) {
            C0FPacketConfirmTransaction packetConfirmTransaction = event.getPacket();
            transactions.add(packetConfirmTransaction);
            event.setCancelled(true);
        } else if (event.getPacket() instanceof C0BPacketEntityAction) {
            event.setCancelled(true);
        }
    }

    @Override
    public void onUpdate(UpdateEvent event) {
        // any ver verus combat disabler LOL
        // thanks dort ily <3
        if (mc.thePlayer.ticksExisted % 180 == 0) {
            ChatUtil.log(transactions.size() + "");

            if (transactions.size() > 20) {
                for (int i = 0; i < transactions.size(); i++) {
                    PacketUtil.sendPacketNoEvent(transactions.poll());
                }
            }
        }
    }

}
