package today.sleek.client.modules.impl.exploit.disabler.matrx;

import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C08PacketPlayerBlockPlacement;
import net.minecraft.network.play.client.C0BPacketEntityAction;
import today.sleek.base.event.impl.PacketEvent;
import today.sleek.client.modules.impl.exploit.disabler.DisablerMode;
import today.sleek.client.utils.network.PacketUtil;

public class Matrix extends DisablerMode {

    public Matrix() {
        super("Matrix");
    }

    @Override
    public void onPacket(PacketEvent event) {
        if (event.getPacket() instanceof C03PacketPlayer) {
            C03PacketPlayer packetPlayer = event.getPacket();
            double x = mc.thePlayer.posX, y = mc.thePlayer.posY, z = mc.thePlayer.posZ;
            float yaw = mc.thePlayer.rotationYaw, pitch = mc.thePlayer.rotationPitch;


            if (packetPlayer.isMoving()) {
                x = packetPlayer.getPositionX();
                y = packetPlayer.getPositionY();
                z = packetPlayer.getPositionZ();
            }
            if (packetPlayer.getRotating()) {
                yaw = packetPlayer.getYaw();
                pitch = packetPlayer.getPitch();
            }
            PacketUtil.sendPacket(2, new C08PacketPlayerBlockPlacement(mc.thePlayer.getPosition().up(384), 256, null, 0, Float.POSITIVE_INFINITY, 0));
            event.setPacket(new C03PacketPlayer.C06PacketPlayerPosLook(x, y, z, yaw, pitch, packetPlayer.isOnGround()));
        } else if (event.getPacket() instanceof C0BPacketEntityAction) {
            event.setCancelled(true);
        } else if (event.getPacket() instanceof C08PacketPlayerBlockPlacement) {
            C08PacketPlayerBlockPlacement packetPlayerBlockPlacement = event.getPacket();
            if (packetPlayerBlockPlacement.getPlacedBlockDirection() >= 255) {
                event.setPacket(new C08PacketPlayerBlockPlacement(packetPlayerBlockPlacement.getPosition(), packetPlayerBlockPlacement.getPlacedBlockDirection(), null, packetPlayerBlockPlacement.getPlacedBlockOffsetX(), packetPlayerBlockPlacement.getPlacedBlockOffsetY(), packetPlayerBlockPlacement.getPlacedBlockOffsetZ()));
            }
        }
    }
}
