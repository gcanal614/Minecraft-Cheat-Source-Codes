package win.sightclient.cmd.commands.exploit;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

import joptsimple.internal.Strings;
import net.minecraft.client.Minecraft;
import net.minecraft.network.Packet;
import net.minecraft.network.play.server.S3APacketTabComplete;
import win.sightclient.cmd.Command;
import win.sightclient.utils.minecraft.ChatUtils;

public class PluginsCommand extends Command {

	public static boolean scanning = false;
	
	public PluginsCommand() {
		super(new String[] {"plugin", "plugins"});
	}

	@Override
	public void onCommand(String message) {
		if (Minecraft.getMinecraft().isSingleplayer()) {
			scanning = false;
			ChatUtils.sendMessage("You can not search for plugins in SinglePlayer.");
		} else {
			scanning = true;
			ChatUtils.sendMessage("Looking for plugins...");
		}
	}
	
	public static void onPacket(Packet p) {
		if (!scanning) {
			return;
		}
        if(p instanceof S3APacketTabComplete) {
            S3APacketTabComplete s3APacketTabComplete = (S3APacketTabComplete) p;
            List<String> plugins = new ArrayList<>();
            String[] commands = s3APacketTabComplete.func_149630_c();

            for (int i = 0; i < commands.length; i++) {
                String[] command = commands[i].split(":");

                if (command.length > 1) {
                    String pluginName = command[0].replace("/", "");

                    if (!plugins.contains(pluginName))
                        plugins.add(pluginName);
                }
            }

            Collections.sort(plugins);
            if (!plugins.isEmpty())
                ChatUtils.sendMessage("§aPlugins §7(§8" + plugins.size() + "§7): §c" + Strings.join(plugins.toArray(new String[0]), "§7, §c"));
            else
            	ChatUtils.sendMessage("§cNo plugins found.");
            scanning = false;
        }
	}
}
