package me.injusttice.neutron.impl.modules.impl.exploit;

import java.util.ArrayList;

import me.injusttice.neutron.api.events.EventTarget;
import me.injusttice.neutron.api.events.impl.EventSendPacket;
import me.injusttice.neutron.api.events.impl.EventTick;
import me.injusttice.neutron.impl.modules.Category;
import me.injusttice.neutron.impl.modules.Module;
import me.injusttice.neutron.api.settings.impl.DoubleSet;
import me.injusttice.neutron.utils.network.PacketUtil;
import me.injusttice.neutron.utils.player.TimerHelper;
import net.minecraft.network.Packet;

public class PingSpoof extends Module {
    
    public DoubleSet pingval = new DoubleSet("Packets Delay", 350.0D, 100.0D, 5000.0D, 50.0D);

    public PingSpoof() {
        super("PingSpoof", 0, Category.EXPLOIT);
        sendPacket = null;
        timer = new TimerHelper();
        setArrayName("Ping Spoof");
        addSettings(pingval);
    }

    private static final ArrayList<Packet> packets = new ArrayList<>();
    private Packet sendPacket;
    private final TimerHelper timer;

    @EventTarget
    public void onSend(EventSendPacket e) {
        if (sendPacket != null && e.getPacket() instanceof net.minecraft.network.play.client.C00PacketKeepAlive && e.getPacket() == sendPacket) {
            sendPacket = null;
        } else if (e.getPacket() instanceof net.minecraft.network.play.client.C00PacketKeepAlive) {
            packets.add(e.packet);
            e.setCancelled(true);
        }
    }

    @EventTarget
    public void onTick(EventTick e) {
        setDisplayName("Ping Spoof ยง7" + String.valueOf(pingval.getValue()));
        if (timer.hasTimeElapsed((long)pingval.getValue(), true) &&
                packets.size() >= 1) {
            sendPacket = packets.get(0);
            PacketUtil.sendPacket(packets.get(0));
            packets.remove(0);
        }
    }
}
