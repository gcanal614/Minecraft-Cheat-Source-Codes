package tk.rektsky.Module.Exploits;

import tk.rektsky.Module.*;
import tk.rektsky.Event.*;
import tk.rektsky.Event.Events.*;
import net.minecraft.network.play.client.*;
import com.mojang.realmsclient.gui.*;
import tk.rektsky.*;

public class AntiTooManyPackets extends Module
{
    int sentThisSecond;
    int ticks;
    
    public AntiTooManyPackets() {
        super("AntiPacketLimit", "Stop getting kicked for sending too many packets", Category.EXPLOIT);
    }
    
    @Override
    public void onEnable() {
        this.ticks = 0;
        this.sentThisSecond = 0;
    }
    
    @Override
    public void onEvent(final Event event) {
        if (event instanceof WorldTickEvent) {
            ++this.ticks;
            if (this.ticks % 20 == 0) {
                this.sentThisSecond = 0;
            }
        }
        if (event instanceof PacketSentEvent) {
            ++this.sentThisSecond;
            if (this.sentThisSecond > 170 && !(((PacketSentEvent)event).getPacket() instanceof C00PacketKeepAlive) && this.mc.theWorld != null && this.mc.thePlayer != null) {
                ((PacketSentEvent)event).setCanceled(true);
                Client.addClientChat(ChatFormatting.RED + "Canceled packet: " + ((PacketSentEvent)event).getPacket().getClass().getName() + " due to sending too many packets per second! (Sent: " + this.sentThisSecond + " packets this second)");
            }
        }
    }
}
